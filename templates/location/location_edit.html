{% extends "layout.html" %}

{% block title %}Edit {{ g.title }}{% endblock %}

{% block head %}
    {% include "map/mapHeaders.html" %}
	<script type="text/javascript">
		$(document).ready(function(){
				// Initialize the map
	            var map = new BAWAMap('{{ config.MAPBOX_PROJECT_ID }}', '{{ config.MAPBOX_ACCESS_TOKEN }}', "locationMap", 15);
	            // Check if we have the location
	            {% if rec == None or rec.latitude == '' or rec.longitude == '' %}
	                // No location, so add the current location
	                map.addCurrentLocation('{{rec.locationName}}', 'latitude', 'longitude');
	            {% else %}
	                // Add the location
	                map.addSimpleLocation('{{rec.locationName}}', {{rec.latitude}}, {{rec.longitude}}, true);
	            {% endif %}
		});
	</script>
{% endblock head %}

{% block body %}
<h2>
	Edit {{ g.title }}
	{% if g.tripTotalCount and g.tripTotalCount > 0 %}
		<span id="tripTotalCount">(Total Count: {{ g.tripTotalCount}})</span>
	{% endif %}
</h2>	
	{% if form %}
        <div id="form-contain">
        <form class="entry" action="{{ g.editURL }}{{rec.ID|default("0",true)}}/" method="POST" enctype="multipart/form-data">
            {% include "editFormButtons.html" %}
            {% from "_form_helpers.html" import render_field_in_table %}
                {{ form.csrf_token }}
            <table class="edit-form-table">
                {% for f in form %}
                    {{ render_field_in_table(f) }}
                {% endfor%}
				<tr>
					<th>Map URL:</th>
					<td><input type="text" id="mapURL" size="120" value="https://www.google.com/maps/place//@{{rec.latitude}},{{rec.longitude}},17z" readonly="readonly" /></td>
				</tr>
            </table>
        </form>
        </div>
        <div id="locationMap"></div>
	{% else %}
		<dt>No form found</dt>
	{% endif %}
{% endblock body %}
